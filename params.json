{
  "name": "Phpintegration",
  "tagline": "PHP library for writing automated tests",
  "body": "# phpintegration\r\nPHP library for writing automated tests. It can help you get started especially when you do TDD and value randomized testing.\r\n\r\n![Build Status](https://travis-ci.org/ksamborski/phpintegration.svg?branch=master)\r\n\r\n## Installation\r\n\r\n```bash\r\ncomposer install ksamborski/php-integration\r\n```\r\n\r\n## Basic usage\r\nYou write test. That's cool. And when you write test that uses random data that's even cooler. But what happens if your test find a bug? You fix it and tries again but the test is random and you cannot simple rerun it. You need to change the test's code, run it and when everything's ok hopefully not forget to remove your changes in test's code. You can also use this library.\r\n\r\nFirst of all let's define some tests:\r\n\r\n```php\r\nuse PHPIntegration\\TestParameter;\r\nuse PHPIntegration\\Test;\r\nuse PHPIntegration\\Console;\r\n\r\n$tests = [\r\n    new Test(\r\n        \"Test1\",\r\n        \"Simple test 1\",\r\n        function($p) {\r\n            usleep(rand(10000, 100000));\r\n            return true;\r\n        }\r\n    ),\r\n    new Test(\r\n        \"Test2\",\r\n        \"Failing test\",\r\n        function($p) {\r\n            return \"this is a test that always fails\";\r\n        }\r\n    )\r\n];\r\n\r\n```\r\nTest is a simple object that has a name, a description and a function that receives parameters. Don't worry about it now, we will cover it later. That function is your test, it should return true when everything's ok and some message explaining what is wrong otherwise.\r\n\r\nNow to avoid changing test code when something fails let's introduce dynamic parameters:\r\n```php\r\n\r\n$params = function() {\r\n    return [\r\n        TestParameter::manyFromParameter(\"departments\", [\"Warsaw\", \"Berlin\"], [\"Warsaw\", \"Berlin\", \"Cracow\"]),\r\n        TestParameter::stringParameter(\"currency\", \"PLN\"),\r\n        TestParameter::regexParameter(\"date\", \"2015-01-01\", \"/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/\"),\r\n        TestParameter::arrayOfParameter(\"hours\", [12], '\\PHPIntegration\\TestParameter::intParameter')\r\n    ];\r\n};\r\n\r\n```\r\n\r\nThese parameters are of course objects. Depending of your needs you can define a string parameter, regex one, parameter of predefined values etc. or custom one. Parameter usually takes a name and default value. This default value can be override at run time. I'll show you later.\r\n\r\nOne thing lacking is console. We need to initialize console interface (CLI) to get some way to use it.\r\n\r\n```php\r\nConsole::main($tests, $params);\r\n```\r\n\r\nIt takes two arguments: array of tests and function generating dynamic parameters. It is a function in the latter case because we need some way to randomize them again after each iteration when we will run some test n times.\r\n\r\nNow let's run it:\r\n```bash\r\nphp basic_example.php\r\n\r\nSimple test 1 [ OK ] 36.46 ms\r\n\r\nFailing test [ FAILED ] 0.00 ms\r\nParameters: \r\n- departments:[Warsaw,Berlin]\r\n- currency:PLN\r\n- date:2015-01-01\r\n- hours:[12]\r\nMessage: \r\nthis is a test that always fails\r\n```\r\n\r\nNow let's override some parameter:\r\n\r\n```bash\r\nphp basic_example.php -p \"currency:EUR\"\r\nSimple test 1 [ OK ] 38.27 ms\r\n\r\nFailing test [ FAILED ] 0.00 ms\r\nParameters: \r\n- departments:[Warsaw,Berlin]\r\n- currency:EUR\r\n- date:2015-01-01\r\n- hours:[12]\r\nMessage: \r\nthis is a test that always fails\r\n```\r\n\r\nOK, but how to use them in a test? Remember the $p argument in tests that we defined previously? That's the parameters map. To read for example the currency you can write:\r\n\r\n```php\r\nnew Test(\r\n        \"Test1\",\r\n        \"Simple test 1\",\r\n        function($p) {\r\n            return $p['currency'];\r\n        }\r\n    )\r\n```\r\n\r\nWhat if we forget what parameters we can pass? CLI for the rescue!\r\n\r\n```bash\r\nphp basic_example.php -h\r\nUsage: php basic_example.php [OPTIONS]\r\n\r\n  -t, --test TEST_NAME                             Run only given tests (you can pass multiple -t option) \r\n  -p, --parameter PARAMETER_NAME:PARAMETER_VALUE   Set test parameter (you can pass multiple -p option) \r\n  -n                                               Number of repeats \r\n\r\n  -h, --help                                       Show this help\r\n\r\nAvailable tests:\r\n- Simple test 1\r\n- Failing test\r\n\r\nAvailable parameters:\r\n- departments \r\n  Default: [Warsaw,Berlin]\r\n- currency \r\n  Default: PLN\r\n- date \r\n  Default: 2015-01-01\r\n- hours \r\n  Default: [12]\r\n```\r\nAs you see we can do many things. Isn't it great?\r\n\r\n## Random\r\n\r\nNext thing we should look at is random_example.php from the examples directory. Let's take a look at parameters:\r\n\r\n```php\r\nuse PHPIntegration\\Utils\\RandomHelper;\r\n\r\n$params = function() {\r\n    return [\r\n        TestParameter::manyFromParameter(\r\n            \"departments\",\r\n            RandomHelper::randomArray([\"Warsaw\", \"Berlin\", \"Cracow\"], false),\r\n            [\"Warsaw\", \"Berlin\", \"Cracow\"]\r\n        ),\r\n        TestParameter::stringParameter(\"currency\", RandomHelper::randomString(3)),\r\n        TestParameter::arrayOfParameter(\r\n            \"hours\",\r\n            RandomHelper::randomMany(function() { return rand(1,24); },1),\r\n            '\\PHPIntegration\\TestParameter::intParameter'\r\n        )\r\n    ];\r\n};\r\n```\r\n\r\nYou can see the same old TestParameter class but there is also RandomHelper. It contains many useful functions for generating random data. For example the randomArray function just generates array containing random elements from the provided list. The last argument decides whether it can contain duplicate values or not. Of course you can generate random string with randomString function and random array with randomMany.\r\n\r\nBut real the beauty is the CLI:\r\n\r\n```bash\r\nWarsaw test 6/100 [ FAILED ] 0.00 ms\r\nParameters: \r\n- departments:[]\r\n- currency:rH/\r\n- hours:[20,14,16,16,22,21]\r\nMessage: \r\nthis test succeeds only if Warsaw is passed\r\n\r\nFailing test 1/100 [ FAILED ] 20.08 ms > 10 ms limit\r\nParameters: \r\n- departments:[Cracow]\r\n- currency:jYy\r\n- hours:[22,5,3,13]\r\nMessage: \r\nthis is a test that always fails\r\n```\r\n\r\nThe n parameter to the script tells it to repeat execution of every test n times. Whenever one fails it stops repeating it and goes to next test. You can spot the \"> 10 ms limit\" in the second test case. This happened because it this test time limit was set. You can do it by providing third parameter to the Test class:\r\n\r\n```php\r\n    new Test(\r\n        \"Test2\",\r\n        \"Failing test\",\r\n        function($p) {\r\n            usleep(20000);\r\n            return \"this is a test that always fails\";\r\n        },\r\n        10\r\n    )\r\n```\r\n10 means the test should finish within 10 ms.\r\n\r\n## Objects as parameters\r\nSo far we defined only string, int and array parameters. But we can do better. We can define objects! Unfortunately to do this we need to implement an interface. Take a look at object_example.php from the examples directory.\r\n\r\n```php\r\nuse PHPIntegration\\Testable;\r\nuse PHPIntegration\\Utils\\RandomHelper;\r\nuse PHPIntegration\\Randomizable;\r\n\r\nclass TestObject implements Randomizable, Testable\r\n{\r\n    public $name;\r\n\r\n    public function __construct(string $name)\r\n    {\r\n        $this->name = $name;\r\n    }\r\n\r\n    public static function build(string $value) : Testable\r\n    {\r\n        return new TestObject($value);\r\n    }\r\n\r\n    public static function validate(string $value, bool $valid = true)\r\n    {\r\n        $fstLetter = substr($value, 0, 1);\r\n        if ($valid === true) {\r\n            if (strtolower($fstLetter) == $fstLetter) {\r\n                return \"Value must start from upper case.\\n\";\r\n            } else {\r\n                return true;\r\n            }\r\n        } else {\r\n            if (strtolower($fstLetter) == $fstLetter) {\r\n                return true;\r\n            } else {\r\n                return \"Value must not start from upper case.\\n\";\r\n            }\r\n        }\r\n    }\r\n\r\n    public function asStringParameter() : string\r\n    {\r\n        return $this->name;\r\n    }\r\n\r\n    public static function randomValid()\r\n    {\r\n        return new TestObject(strtoupper(RandomHelper::randomString()));\r\n    }\r\n\r\n    public static function randomInvalid()\r\n    {\r\n        return new TestObject(strtolower(RandomHelper::randomString()));\r\n    }\r\n}\r\n```\r\n\r\nTo use object as parameter we need to implement only Testable interface. To make it random we need also implement Randomizable interface. There are 3 methods in the Testable interface: build, validate and asStringParameter. Build is easy, it just takes whatever user wrote in the -p option and must create an object from it. Validate method is executed just before it to make sure that this string makes sense. When not CLI will display error. And asStringParameter is used when test fails to show the parameter value that user can pass again (useful when object is not provided but randomized).\r\n\r\n```bash\r\nphp object_example.php -p \"first name:john\"    \r\nBad param `first name` value `john`\r\nValue must start from upper case.\r\n```\r\n\r\nRandomizable is much simpler. There are only 2 methods. One for generating object with valid data. For example when it would be a database connection string it would point to the existing database. And the other one for invalid data (for instance connection string to not existing database).\r\n\r\nYou can randomize object with randomObject method from the RandomHelper class. To use object as a parameter you need to use objectParameter method from the TestParameter class.\r\n\r\n## Other things\r\n\r\nYou should definitely check the examples folder.\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}